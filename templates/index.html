<!DOCTYPE html>
<html>
<head>
    <title>Secure File Sharing via QR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 500px;
            margin: 40px auto;
            padding: 25px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            position: relative;
        }
        .admin-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #333;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .admin-login-form {
            display: none;
            margin-top: 15px;
            padding: 10px;
            background: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .admin-login-form input {
            padding: 8px;
            width: 80%;
            margin-bottom: 10px;
        }
        h2 { text-align: center; color: #333; }
        form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        input[type="file"],
        input[type="text"],
        input[type="password"] {
            padding: 10px;
            font-size: 14px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 8px;
        }
        .btn:hover { background-color: #0056b3; }
        .qr-section {
            text-align: center;
            margin-top: 30px;
        }
        img { max-width: 100%; height: auto; }
        .note {
            font-size: 13px;
            color: #777;
            margin: 0;
        }
        .password-group { display: none; }
        @media screen and (max-width: 600px) {
            .container { margin: 20px; padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Admin Button -->
        <button class="admin-btn" onclick="toggleAdminLogin()">Admin</button>

        <!-- Admin Login Form -->
        <form class="admin-login-form" method="POST" action="/admin-login" id="adminForm">
            <input type="password" name="password" placeholder="Enter Admin Password" required>
            <button class="btn" type="submit">Login</button>
        </form>

        <h2>Secure File Sharing via QR</h2>

        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="file" required accept=".pdf,.docx,.txt,.jpg,.png,.zip,.mp4">
            <p id="file-name" class="note"></p>
            <p class="note">⚠️ Max file size: <strong>100MB</strong></p>
            <p class="note">Supported types: PDF, DOCX, TXT, JPG, PNG, ZIP, MP4</p>

            <label><input type="radio" name="access" value="public" checked> Public</label>
            <label><input type="radio" name="access" value="private"> Private (Password Protected)</label>

            <div class="password-group">
                <input type="password" name="password" id="password" placeholder="Enter password to protect file">
            </div>

            <button class="btn" type="submit">Upload</button>
        </form>

        {% if qr_path %}
        <div class="qr-section">
            <h3>QR Code for Secure Download:</h3>
            <img src="{{ qr_path }}" alt="QR Code">
            <br><br>
            <a href="{{ qr_path }}" download><button class="btn">Download QR Code</button></a>

            <p><strong>Or share this link directly:</strong></p>
            <input type="text" id="download-link" readonly value="{{ request.host_url }}download/{{ encrypted_filename }}">
            <button class="btn" onclick="copyLink()">Copy Link</button>

            <p><em>This file will automatically decrypt when the QR is scanned or link is clicked.</em></p>
        </div>
        {% endif %}
    </div>

    <script>
        function copyLink() {
            const linkInput = document.getElementById("download-link");
            linkInput.select();
            linkInput.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(linkInput.value).then(() => {
                alert("Link copied to clipboard!");
            });
        }

        const fileInput = document.querySelector('input[type="file"]');
        const fileNameDisplay = document.getElementById('file-name');
        fileInput.addEventListener('change', function () {
            fileNameDisplay.textContent = fileInput.files.length > 0
                ? "Selected file: " + fileInput.files[0].name
                : "";
        });

        const radioButtons = document.querySelectorAll('input[name="access"]');
        const passwordGroup = document.querySelector('.password-group');
        radioButtons.forEach(radio => {
            radio.addEventListener('change', function () {
                if (this.value === 'private') {
                    passwordGroup.style.display = 'block';
                    document.getElementById('password').setAttribute('required', true);
                } else {
                    passwordGroup.style.display = 'none';
                    document.getElementById('password').removeAttribute('required');
                }
            });
        });

        function toggleAdminLogin() {
            const form = document.querySelector('.admin-login-form');
            form.style.display = form.style.display === 'block' ? 'none' : 'block';
        }
    </script>
</body>
</html>
